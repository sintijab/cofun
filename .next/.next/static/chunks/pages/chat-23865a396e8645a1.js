(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{6083:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return n(3389)}])},3389:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var i=n(4246),s=n(4398),o=n(9772),r=n(7378);let l=(0,o.io)(void 0),u=()=>{let e=(0,r.useRef)(null),t=()=>{l.on("connect",()=>{console.log("Connected")}),l.on("disconnect",()=>{console.log("Disconnected")}),l.on("connect_error",async e=>{console.log("connect_error due to ".concat(e.message))}),e.current=l};(0,r.useEffect)(()=>(t(),()=>{var t;null==e||null===(t=e.current)||void 0===t||t.disconnect()}),[])};var a=n(6125),c=n(639),d=n(3868);let p=(e,t)=>{let n=[];if(n=[...e,{response:null==t?void 0:t.questions[0]}],t.questions&&t.questions.length>0){var i;n=[...e,...null==t?void 0:null===(i=t.questions)||void 0===i?void 0:i.map(e=>({response:e}))]}return n};function g(){var e;let[t,n]=(0,r.useState)([]),[o,g]=(0,r.useState)([]),[m,v]=(0,r.useState)(),w=(0,a.I0)(),[y,_]=(0,r.useState)(),[f,h]=(0,r.useState)(),[S,k]=(0,r.useState)(),b=(0,a.v9)(c.T1),{data:j}=(0,d.useSession)(),x=null==j?void 0:null===(e=j.user)||void 0===e?void 0:e.email;u(),(0,r.useEffect)(()=>{l.volatile.emit("init",e=>{n(p(t,e)),_(e.activeKey),e.suggestions&&g(e.suggestions)})},[]),(0,r.useEffect)(()=>{if("close"===f){let e=new Date;f&&S&&(w((0,c.AM)({data:{...b[0],date:e.toLocaleString("en",{timeZone:"Europe/Berlin"})},endpoint:S})),h(void 0))}},[S]);let E=e=>{let i=[...t,{response:e,author:"Sintija"}];n(i),l.volatile.emit("update_item",y,e,t=>{try{h(t.id),t.type&&(console.log(S),k(t.type)),w((0,c.wo)({[f]:e}))}catch(e){console.log(e)}_(t.activeKey),i=p(i,t),t.suggestions&&g(t.suggestions),n(i),"button_select"===t.type&&v({title:t.title,description:t.description,answers:t.answers})})},C={title:"What are you listening now?",category:"Discovery & Analytics",time:"1 min",image:(0,i.jsx)(s.LipsIcon,{h:"2.5rem",w:"2.5rem",p:".3rem",borderRadius:"50%",border:"1px",mr:".75rem"}),isActive:!0};return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(s.AIAssistantChat,{onClickSuggestion:e=>{let i=o[e].answer;g([]),l.volatile.emit("update_item",y,o[e].key,e=>{let s=[...t,{response:i,author:"Sintija"}];h(e.id),"listening_init"===y&&w((0,c.wo)({connection:"open",...x&&{user_email:x}})),n(s=p(s,e)),e.suggestions&&g(e.suggestions),_(e.activeKey),"button_select"===e.type&&v({title:e.title,description:e.description,answers:e.answers})})},suggestions:o,history:t,onSubmit:e=>E(e),image:(0,i.jsx)(s.LipsIcon,{h:"2rem",w:"2rem",p:".3rem",borderRadius:"50%",m:"0 .5rem 0 2rem",border:"1px"}),conversations:[C],author:"",title:"What are you listening now?",children:m&&(0,i.jsx)(s.Box,{m:"1rem 0 1rem 5rem",children:(0,i.jsx)(s.ButtonList,{title:m.title,description:null==m?void 0:m.description,answers:m.answers,onClick:e=>{let i=null==m?void 0:m.answers.find(t=>t.key===e),s=[...t,{response:i.answer,author:"Sintija"}];l.volatile.emit("update_item",y||i.key,i.key,e=>{w((0,c.wo)({[f]:i.key})),_(e.activeKey),h(e.id),e.type&&k(e.type),s=p(s,e),e.suggestions&&g(e.suggestions),n(s),v(void 0),"button_select"===e.type&&v({title:e.title,description:e.description,answers:e.answers})})}})})})})}}},function(e){e.O(0,[868,242,888,774,179],function(){return e(e.s=6083)}),_N_E=e.O()}]);